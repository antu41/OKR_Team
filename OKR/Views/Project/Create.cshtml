@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}

<div class="container">
    <div class="row">
        <div class="col-md-12 text-center vertical-center">
            <button class="btn btn-primary btn-lg" id="btnAddProject">+ Create Project</button>
        </div>
    </div>
</div>

@* <div id="example-table"></div> *@

<div id="project-container"></div>

<div class="modal fade" id="ProjectModal" tabindex="-1" aria-labelledby="createProjectModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Create Project</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form enctype="multipart/form-data" method="post">
                    <div class="form-group">
                        <label class="form-label"></label>
                        <input type="text" placeholder="Enter your project name" class="form-control" id="name" autocomplete="off" />
                    </div>
                    <div class="form-group">
                        <label class="form-label">Assign to</label>
                        <select id="assignee" class="js-example-basic-multiple" name="states[]" multiple="multiple" asp-items="@ViewBag.Assignee" style="width: 100%">
                            <option value="" disabled selected>-- Select Employee --</option>
                        </select>

                    </div>
                    @*<div class="form-group">
                    <label class="col-sm-2 col-form-label">Attachment:</label>
                    <div class="custom-file">
                    <input type="file" class="form-control custom-file-input" id="attachment" />
                    <label class="custom-file-label">Choose</label>

                    </div>
                    </div> *@

                    <div class="form-group">
                        <label class="form-label">Description</label>
                        <textarea class="form-control" id="description" rows="3"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="CreateProject();">Create</button>
            </div>
        </div>
    </div>
</div>


@section Scripts {
    <script>
        $(document).ready(function () {
            $('#btnAddProject').click(function () {
                $('#ProjectModal').modal('show');
            });

            $('.js-example-basic-multiple').select2();

            $('#attachment').on("change", function () {
                var fileName = $(this).val().split("\\").pop();
                $(this).next('.custom-file-label').html(fileName);
            });

            $.ajax({
                url: '/Project/GetProjects',
                type: 'GET',
                success: function (data) {
                    // Clear previous content
                    $('#project-container').empty();
                    // Iterate through projects and create cards
                    $.each(data, function (index, project) {
                        var card = '<div class="col-md-4">' +
                            '<div class="card mb-4">' +
                            '<div class="card-body">' +
                            '<h5 class="card-title">' + project.projectName + '</h5>' +
                            '<p class="card-text">' + project.description + '</p>' +
                            '</div>' +
                            '</div>' +
                            '</div>';
                        $('#project-container').append(card);
                    });
                },
                error: function (xhr, status, error) {
                    console.error(xhr.responseText);
                }
            });

        });

        function CreateProject() {
            var objData = {
                ProjectName: $('#name').val(),
                AssigneeId: $('#assignee').val(),
                //FilePath: $('#attachment').val(),
                Description: $('#description').val()
            };

            $.ajax({
                url: '/Project/Create',
                type: 'Post',
                data: JSON.stringify(objData),
                contentType: 'application/json',
                success: function (response) {
                    alert('Project created successfully');
                    clear();
                    Hide();

                },
                error: function () {
                    alert("Failed to create project");
                }
            });
        }

        function Hide() {
            $('#ProjectModal').modal('hide');
        }

        function clear() {
            $('#name').val('');
            $('#assignee').val('').trigger('change');
            $('#attachment').val('');
            $('#description').val('');
        }





           

    </script>
}

